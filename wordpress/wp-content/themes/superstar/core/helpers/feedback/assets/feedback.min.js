!function(a,b){"use strict";b.PojoFeedback={},b.PojoFeedback.views={},b.PojoFeedback.models={},b.PojoFeedback.models.Model=Backbone.Model.extend({defaults:{campaign:"1",rating:"",comment:"",_nonce:""},validate:function(a,b){return _.isEmpty(a.rating)?"rating:empty":void 0}}),b.PojoFeedback.views.Modal=new wp.media.view.Modal({controller:{trigger:function(){}}}),b.PojoFeedback.views.ModalContentView=wp.media.view.Settings.extend({tagName:"div",className:"pojo-feedback-modal",template:wp.template("pojo-feedback-panel"),events:{"keyup input":"updateHandler","keyup textarea":"updateHandler","click .feedback-submit":"submitFeedback"},initialize:function(){_.extend(this.events,wp.media.view.Settings.prototype.events),wp.media.view.Settings.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.onModelChanged)},render:function(){var a=wp.media.view.Settings.prototype.render.apply(this,arguments);return this.onModelChanged(),a},onModelChanged:function(){this.$buttonSubmit=this.$(".feedback-submit"),this.model.isValid()?this.$buttonSubmit.removeProp("disabled"):this.$buttonSubmit.prop("disabled","disabled")},showSpinner:function(){this.$("span.spinner").addClass("is-active")},hideSpinner:function(){this.$("span.spinner").removeClass("is-active")},showMessage:function(a,b){var c=this.$("div.messages");b=b||"success","success"===b?(c.removeClass("error"),c.addClass("updated")):(c.removeClass("updated"),c.addClass("error")),c.html(a)},submitFeedback:function(){var b=this;b.model.isValid()&&(b.showSpinner(),wp.ajax.post("pojo_send_feedback",b.model.toJSON()).done(function(c){b.showMessage(c.msg),b.$("div.feedback-form").hide(),a("div.feedback-camp-"+b.model.get("campaign")).hide()}).fail(function(a){b.showMessage(a.msg,"error"),b.hideSpinner()}))}}),a(document).ready(function(){a("a.pojo-feedback-button").on("click",function(c){c.preventDefault(),b.PojoFeedback.views.Modal.content(new b.PojoFeedback.views.ModalContentView({model:new b.PojoFeedback.models.Model({campaign:a(this).data("campaign"),_nonce:a(this).data("nonce")})})),b.PojoFeedback.views.Modal.open()}),a("a.pojo-dismiss-feedback-button").on("click",function(b){b.preventDefault(),a(this).closest("div.updated").fadeOut("fast"),a.post(ajaxurl,{campaign:a(this).data("campaign"),action:"dismiss_pojo_feedback"})})})}(jQuery,window);